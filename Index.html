<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>POKPOk61</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #0F172A; color: white; overflow: hidden; touch-action: none; }
        .bg-gold { background: linear-gradient(135deg, #FCD34D 0%, #B45309 100%); }
        .text-gold { background: linear-gradient(to bottom, #FCD34D, #d97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .input-dark { background: #1e293b; border: 1px solid #334155; color: white; width: 100%; padding: 12px; border-radius: 10px; outline: none; transition: 0.3s; }
        .input-dark:focus { border-color: #FCD34D; }
        
        /* Card Animation */
        .card-img { width: 70px; height: 100px; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.5); transition: transform 0.3s; }
        .card-deal { animation: dealFly 0.5s ease-out forwards; }
        @keyframes dealFly { from { transform: translateY(-200px) scale(0.5); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
    </style>
</head>
<body class="h-screen flex flex-col">

    <div id="screen-auth" class="fixed inset-0 z-50 flex items-center justify-center bg-[url('https://images.unsplash.com/photo-1565514020176-db793577d619?q=80&w=1972')] bg-cover bg-center">
        <div class="absolute inset-0 bg-black/80"></div>
        <div class="relative w-full max-w-sm p-6 mx-4 glass rounded-2xl shadow-2xl border-t-2 border-yellow-600">
            <div class="text-center mb-6">
                <i class="fas fa-crown text-5xl text-yellow-500 mb-2"></i>
                <h1 class="text-3xl font-bold tracking-widest text-white">UFA<span class="text-yellow-500">VVIP</span></h1>
            </div>

            <div id="form-login">
                <input type="text" id="log-user" placeholder="เบอร์โทรศัพท์" class="input-dark mb-3">
                <input type="password" id="log-pass" placeholder="รหัสผ่าน" class="input-dark mb-4">
                <button onclick="login()" class="w-full bg-gold text-black font-bold py-3 rounded-xl shadow-lg hover:brightness-110 mb-3">เข้าสู่ระบบ</button>
                <div class="text-center text-gray-400 text-sm">ยังไม่มียูสเซอร์? <span onclick="toggleAuth('reg')" class="text-yellow-500 cursor-pointer underline">สมัครสมาชิก</span></div>
            </div>

            <div id="form-reg" class="hidden space-y-3">
                <input type="text" id="reg-phone" placeholder="เบอร์โทรศัพท์ (ใช้เข้าสู่ระบบ)" class="input-dark">
                <input type="password" id="reg-pass" placeholder="ตั้งรหัสผ่าน" class="input-dark">
                <div class="flex gap-2">
                    <input type="text" id="reg-name" placeholder="ชื่อ-นามสกุล" class="input-dark w-1/2">
                    <select id="reg-bank" class="input-dark w-1/2">
                        <option value="kbank">กสิกรไทย</option>
                        <option value="scb">ไทยพาณิชย์</option>
                        <option value="ktb">กรุงไทย</option>
                        <option value="bbl">กรุงเทพ</option>
                        <option value="true">TrueWallet</option>
                    </select>
                </div>
                <input type="text" id="reg-acc" placeholder="เลขบัญชีธนาคาร" class="input-dark">
                <button onclick="register()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg mt-2">ยืนยันการสมัคร</button>
                <div class="text-center text-gray-400 text-sm mt-2"><span onclick="toggleAuth('login')" class="text-yellow-500 cursor-pointer underline">กลับไปหน้าล็อกอิน</span></div>
            </div>
        </div>
    </div>

    <div id="screen-app" class="hidden flex-1 flex flex-col relative bg-slate-900">
        <header class="h-16 glass flex items-center justify-between px-4 sticky top-0 z-40 bg-slate-900/90">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-yellow-400 to-yellow-600 flex items-center justify-center text-black font-bold text-lg"><i class="fas fa-user"></i></div>
                <div>
                    <div id="ui-user" class="text-sm font-bold text-white">User</div>
                    <div class="text-xs text-green-400">Online</div>
                </div>
            </div>
            <div class="bg-black/50 px-4 py-1.5 rounded-full border border-yellow-500/50 flex items-center gap-2">
                <i class="fas fa-coins text-yellow-500"></i>
                <span id="ui-bal" class="font-mono font-bold text-lg text-white">0.00</span>
            </div>
        </header>

        <main class="flex-1 relative overflow-hidden">
            
            <div id="page-lobby" class="absolute inset-0 p-4 overflow-y-auto space-y-4">
                <div class="h-40 rounded-2xl bg-gradient-to-r from-yellow-700 to-yellow-900 relative overflow-hidden flex items-center px-6 shadow-xl">
                    <div class="relative z-10">
                        <h2 class="text-2xl font-bold text-white">ยินดีต้อนรับ</h2>
                        <p class="text-yellow-200 text-sm">คาสิโนออนไลน์ อันดับ 1 ของไทย</p>
                    </div>
                    <i class="fas fa-crown absolute -right-4 -bottom-4 text-9xl text-white opacity-10"></i>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="nav('game')" class="col-span-2 bg-slate-800 h-28 rounded-2xl border border-slate-700 flex flex-col items-center justify-center gap-2 relative overflow-hidden group">
                        <img src="https://images.unsplash.com/photo-1605806616949-1e87b487bc2a?q=80&w=1974" class="absolute inset-0 w-full h-full object-cover opacity-50 group-hover:scale-110 transition duration-700">
                        <div class="relative z-10 flex flex-col items-center">
                            <i class="fas fa-play-circle text-4xl text-yellow-500 shadow-lg bg-black rounded-full"></i>
                            <span class="font-bold mt-1 text-white text-lg shadow-black drop-shadow-md">เข้าเล่นเกม</span>
                        </div>
                    </button>
                    <button onclick="openTxn('deposit')" class="bg-slate-800 p-4 rounded-2xl border border-slate-700 hover:border-green-500 transition flex flex-col items-center gap-2">
                        <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center text-green-500 text-xl"><i class="fas fa-arrow-down"></i></div>
                        <span>ฝากเงิน</span>
                    </button>
                    <button onclick="openTxn('withdraw')" class="bg-slate-800 p-4 rounded-2xl border border-slate-700 hover:border-red-500 transition flex flex-col items-center gap-2">
                        <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center text-red-500 text-xl"><i class="fas fa-arrow-up"></i></div>
                        <span>ถอนเงิน</span>
                    </button>
                </div>
                
                <button onclick="logout()" class="w-full py-3 text-red-500 border border-red-500/30 rounded-xl hover:bg-red-500/10 mt-4">ออกจากระบบ</button>
            </div>

            <div id="page-game" class="absolute inset-0 bg-[#0f361e] hidden flex flex-col">
                <div class="absolute top-0 w-full p-2 flex justify-between items-center z-10">
                    <button onclick="nav('lobby')" class="bg-black/40 w-10 h-10 rounded-full text-white"><i class="fas fa-home"></i></button>
                    <div class="bg-black/40 px-3 py-1 rounded-full text-xs">ROOM: VIP 888</div>
                </div>

                <div class="flex-1 flex flex-col justify-between py-10 relative bg-[radial-gradient(circle,_#15803d_0%,_#022c22_100%)]">
                    <div class="flex flex-col items-center mt-6">
                        <div class="w-16 h-16 rounded-full bg-slate-800 border-2 border-yellow-500 flex items-center justify-center text-2xl shadow-xl z-10 relative mb-[-20px]">
                            <i class="fas fa-user-secret text-gray-400"></i>
                        </div>
                        <div id="hand-dealer" class="flex justify-center gap-2 h-28 w-full pt-8"></div>
                        <div id="score-dealer" class="bg-red-600 px-2 rounded text-xs font-bold mt-1 hidden">0 แต้ม</div>
                    </div>

                    <div id="game-status" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-4xl font-black text-white drop-shadow-lg hidden z-50">WIN</div>

                    <div class="flex flex-col items-center mb-24">
                        <div id="score-player" class="bg-blue-600 px-2 rounded text-xs font-bold mb-1 hidden">0 แต้ม</div>
                        <div id="hand-player" class="flex justify-center gap-2 h-28 w-full relative z-10"></div>
                        <div class="bg-black/50 px-4 py-1 rounded-full text-sm font-bold mt-[-10px] z-20 border border-white/20">คุณ (Player)</div>
                    </div>
                </div>

                <div class="absolute bottom-0 w-full bg-slate-900/95 p-4 border-t border-slate-700 z-30 pb-8">
                    <div id="ctrl-bet" class="flex flex-col gap-3">
                        <div class="flex justify-center gap-4">
                            <div onclick="setBet(10)" class="w-14 h-14 rounded-full bg-[url('https://cdn-icons-png.flaticon.com/512/1198/1198305.png')] bg-cover shadow-lg hover:-translate-y-1 transition cursor-pointer flex items-center justify-center font-black text-black text-xs pt-1">10</div>
                            <div onclick="setBet(50)" class="w-14 h-14 rounded-full bg-[url('https://cdn-icons-png.flaticon.com/512/1198/1198306.png')] bg-cover shadow-lg hover:-translate-y-1 transition cursor-pointer flex items-center justify-center font-black text-black text-xs pt-1">50</div>
                            <div onclick="setBet(100)" class="w-14 h-14 rounded-full bg-[url('https://cdn-icons-png.flaticon.com/512/1198/1198307.png')] bg-cover shadow-lg hover:-translate-y-1 transition cursor-pointer flex items-center justify-center font-black text-black text-xs pt-1">100</div>
                        </div>
                        <p class="text-center text-sm text-gray-400">เดิมพัน: <span id="txt-bet" class="text-yellow-500 font-bold text-lg">0</span></p>
                        <button onclick="startGame()" id="btn-deal" class="w-full bg-gradient-to-r from-green-600 to-green-800 py-3 rounded-xl font-bold shadow-lg disabled:opacity-50" disabled>แจกไพ่</button>
                    </div>
                    <div id="ctrl-action" class="hidden flex gap-3">
                        <button onclick="hit()" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold shadow-lg">จั่ว (Hit)</button>
                        <button onclick="stay()" class="flex-1 bg-red-600 py-3 rounded-xl font-bold shadow-lg">พอ (Stay)</button>
                    </div>
                    <div id="ctrl-reset" class="hidden">
                        <button onclick="resetGame()" class="w-full bg-yellow-500 text-black py-3 rounded-xl font-bold shadow-lg">เล่นตาต่อไป</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-txn" class="fixed inset-0 z-[60] bg-black/90 hidden items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-xs p-6 rounded-2xl relative border border-slate-700">
            <button onclick="document.getElementById('modal-txn').classList.add('hidden')" class="absolute top-3 right-3 text-gray-400"><i class="fas fa-times"></i></button>
            <h3 id="txn-title" class="text-xl font-bold mb-4 text-center">ทำรายการ</h3>
            <div id="txn-bank-info" class="bg-slate-900 p-3 rounded mb-3 text-center hidden">
                <p class="text-xs text-gray-400">โอนมาที่</p>
                <p class="text-green-400 font-bold text-lg">123-4-56789-0</p>
                <p class="text-xs">KBANK - บจก. ยูฟ่า</p>
            </div>
            <input type="number" id="txn-amt" placeholder="ระบุจำนวนเงิน" class="input-dark mb-4 text-center text-xl font-bold">
            <button onclick="confirmTxn()" class="w-full bg-gold text-black font-bold py-3 rounded-xl">ยืนยัน</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyABuBrdprpiN32ZD4cSCiSslkYbRfnWGgE",
            authDomain: "namba-fe57a.firebaseapp.com",
            projectId: "namba-fe57a",
            storageBucket: "namba-fe57a.appspot.com",
            messagingSenderId: "340416568750",
            appId: "1:340416568750:web:bb0a58ee618978bc107c3f"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;
        let userData = {};

        // --- AUTH ---
        function toggleAuth(mode) {
            document.getElementById('form-login').classList.toggle('hidden', mode === 'reg');
            document.getElementById('form-reg').classList.toggle('hidden', mode === 'login');
        }

        function register() {
            const tel = document.getElementById('reg-phone').value;
            const pass = document.getElementById('reg-pass').value;
            const name = document.getElementById('reg-name').value;
            const bank = document.getElementById('reg-bank').value;
            const acc = document.getElementById('reg-acc').value;

            if(!tel || !pass || !name || !acc) return Swal.fire('Error', 'กรอกข้อมูลให้ครบ', 'error');

            const email = tel + "@ufavvip.com"; // สร้างอีเมลหลอกๆ เพื่อใช้ Firebase Auth

            auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                // Save extra data to Firestore
                db.collection('users').doc(cred.user.uid).set({
                    phone: tel, name: name, bank: bank, acc: acc, 
                    balance: 0, role: 'user', createdAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    Swal.fire('สำเร็จ', 'สมัครสมาชิกเรียบร้อย', 'success');
                });
            }).catch(e => Swal.fire('Error', e.message, 'error'));
        }

        function login() {
            const tel = document.getElementById('log-user').value;
            const pass = document.getElementById('log-pass').value;
            if(!tel || !pass) return;
            auth.signInWithEmailAndPassword(tel + "@ufavvip.com", pass).catch(e => Swal.fire('ไม่พบผู้ใช้', 'เบอร์หรือรหัสผิด', 'error'));
        }

        function logout() { auth.signOut(); location.reload(); }

        auth.onAuthStateChanged(u => {
            currentUser = u;
            if(u) {
                document.getElementById('screen-auth').classList.add('hidden');
                document.getElementById('screen-app').classList.remove('hidden');
                // Realtime Listen
                db.collection('users').doc(u.uid).onSnapshot(doc => {
                    if(doc.exists) {
                        userData = doc.data();
                        document.getElementById('ui-bal').innerText = userData.balance.toLocaleString('en-US', {minimumFractionDigits:2});
                        document.getElementById('ui-user').innerText = userData.phone;
                    }
                });
            } else {
                document.getElementById('screen-auth').classList.remove('hidden');
                document.getElementById('screen-app').classList.add('hidden');
            }
        });

        // --- NAVIGATION ---
        function nav(page) {
            document.getElementById('page-lobby').classList.add('hidden');
            document.getElementById('page-game').classList.add('hidden');
            document.getElementById('page-'+page).classList.remove('hidden');
            if(page === 'game') resetGame();
        }

        // --- TRANSACTION ---
        let currentTxnType = '';
        function openTxn(type) {
            currentTxnType = type;
            document.getElementById('modal-txn').classList.remove('hidden');
            document.getElementById('txn-title').innerText = type === 'deposit' ? 'ฝากเงิน' : 'ถอนเงิน';
            document.getElementById('txn-bank-info').classList.toggle('hidden', type !== 'deposit');
        }

        function confirmTxn() {
            const amt = parseFloat(document.getElementById('txn-amt').value);
            if(!amt || amt <= 0) return Swal.fire('ระบุยอดเงินให้ถูกต้อง');
            if(currentTxnType === 'withdraw' && amt > userData.balance) return Swal.fire('ยอดเงินไม่พอ');

            db.collection('transactions').add({
                uid: currentUser.uid,
                phone: userData.phone,
                name: userData.name,
                type: currentTxnType,
                amount: amt,
                status: 'pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                Swal.fire('ทำรายการสำเร็จ', 'กรุณารอแอดมินตรวจสอบ', 'success');
                document.getElementById('modal-txn').classList.add('hidden');
                document.getElementById('txn-amt').value = '';
            });
        }

        // --- GAME ENGINE (Real Images) ---
        let bet = 0;
        let deck = [], pHand = [], dHand = [];
        
        function setBet(a) { 
            if(bet + a > userData.balance) return Swal.fire('เงินไม่พอ');
            bet += a; 
            document.getElementById('txt-bet').innerText = bet;
            document.getElementById('btn-deal').disabled = false;
        }

        async function createDeck() {
            // Use Deck of Cards API logic but local mapping or online images
            const suits = ['H', 'D', 'C', 'S']; // Heart, Diamond, Club, Spade
            const values = ['A','2','3','4','5','6','7','8','9','0','J','Q','K']; // 0 = 10
            deck = [];
            for(let s of suits) for(let v of values) {
                deck.push({ code: v+s, value: getVal(v) });
            }
            deck.sort(() => Math.random() - 0.5);
        }
        function getVal(v) {
            if(v === '0' || v === 'J' || v === 'Q' || v === 'K') return 10; // 0 for 10
            if(v === 'A') return 1;
            return parseInt(v);
        }

        function getCardImg(code) {
            // Using reliable CDN for card images
            return `https://deckofcardsapi.com/static/img/${code}.png`;
        }

        function renderCard(handDivId, card, hidden = false) {
            const div = document.getElementById(handDivId);
            const img = document.createElement('img');
            img.src = hidden ? 'https://deckofcardsapi.com/static/img/back.png' : getCardImg(card.code);
            img.className = 'card-img card-deal';
            div.appendChild(img);
        }

        async function startGame() {
            // Deduct money first (Client side logic)
            db.collection('users').doc(currentUser.uid).update({ balance: userData.balance - bet });
            
            await createDeck();
            document.getElementById('ctrl-bet').classList.add('hidden');
            pHand = [deck.pop(), deck.pop()];
            dHand = [deck.pop(), deck.pop()];

            // Animation
            renderCard('hand-dealer', dHand[0], true);
            setTimeout(() => renderCard('hand-dealer', dHand[1], true), 200);
            setTimeout(() => renderCard('hand-player', pHand[0]), 400);
            setTimeout(() => renderCard('hand-player', pHand[1]), 600);

            setTimeout(() => {
                calcScore();
                if(pScore >= 8 || dScore >= 8) {
                    endGame();
                } else {
                    document.getElementById('ctrl-action').classList.remove('hidden');
                }
            }, 1000);
        }

        function hit() {
            const c = deck.pop();
            pHand.push(c);
            renderCard('hand-player', c);
            calcScore();
            stay();
        }

        function stay() {
            document.getElementById('ctrl-action').classList.add('hidden');
            // Dealer Logic
            if(dScore < 4) {
                setTimeout(() => {
                    const c = deck.pop();
                    dHand.push(c);
                    renderCard('hand-dealer', c, true); // Visual fix: should reveal later, but simplistic here
                    endGame();
                }, 500);
            } else {
                endGame();
            }
        }

        let pScore = 0, dScore = 0;
        function calcScore() {
            pScore = pHand.reduce((a,b) => a + (b.value >= 10 ? 0 : b.value), 0) % 10;
            dScore = dHand.reduce((a,b) => a + (b.value >= 10 ? 0 : b.value), 0) % 10;
            document.getElementById('score-player').innerText = pScore + " แต้ม";
            document.getElementById('score-player').classList.remove('hidden');
        }

        function endGame() {
            calcScore();
            // Reveal Dealer
            const dDiv = document.getElementById('hand-dealer');
            dDiv.innerHTML = '';
            dHand.forEach(c => {
                const img = document.createElement('img');
                img.src = getCardImg(c.code);
                img.className = 'card-img';
                dDiv.appendChild(img);
            });
            document.getElementById('score-dealer').innerText = dScore + " แต้ม";
            document.getElementById('score-dealer').classList.remove('hidden');

            // Winner?
            let winAmt = 0;
            const status = document.getElementById('game-status');
            status.classList.remove('hidden');
            
            if(pScore > dScore) {
                status.innerText = "YOU WIN";
                status.className = "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-5xl font-black text-green-500 drop-shadow-[0_2px_2px_rgba(0,0,0,1)] z-50 animate-bounce";
                winAmt = bet * 2;
            } else if (pScore < dScore) {
                status.innerText = "YOU LOSE";
                status.className = "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-5xl font-black text-red-500 drop-shadow-[0_2px_2px_rgba(0,0,0,1)] z-50";
            } else {
                status.innerText = "DRAW";
                status.className = "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-5xl font-black text-gray-300 drop-shadow-[0_2px_2px_rgba(0,0,0,1)] z-50";
                winAmt = bet;
            }

            if(winAmt > 0) {
                db.collection('users').doc(currentUser.uid).update({ balance: userData.balance + winAmt });
            }

            document.getElementById('ctrl-reset').classList.remove('hidden');
        }

        function resetGame() {
            bet = 0; pHand = []; dHand = [];
            document.getElementById('txt-bet').innerText = '0';
            document.getElementById('btn-deal').disabled = true;
            document.getElementById('ctrl-bet').classList.remove('hidden');
            document.getElementById('ctrl-action').classList.add('hidden');
            document.getElementById('ctrl-reset').classList.add('hidden');
            document.getElementById('hand-player').innerHTML = '';
            document.getElementById('hand-dealer').innerHTML = '';
            document.getElementById('score-player').classList.add('hidden');
            document.getElementById('score-dealer').classList.add('hidden');
            document.getElementById('game-status').classList.add('hidden');
        }

    </script>
</body>
</html>
